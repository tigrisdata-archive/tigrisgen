package main

import (
	"text/template"

	"github.com/tigrisdata/tigris-client-go/tigris"
)

var tigrisFilters = map[string]string{}

var tigrisUpdates = map[string]string{}

func init() {
	if tigris.Filters == nil {
		tigris.Filters = make(map[string]tigris.NativeFilter)
	}

	if tigris.Updates != nil {
		tigris.Updates = make(map[string]tigris.NativeFilter)
	}

	for k, v := range tigrisFilters {
		c, err := template.New(k).Parse(v)
		if err != nil {
			panic(err)
		}

		tigris.Filters[k] = tigris.NativeFilter{
			Raw:      v,
			Compiled: c,
		}
	}

	for k, v := range tigrisUpdates {
		c, err := template.New(k).Parse(v)
		if err != nil {
			panic(err)
		}

		tigris.Updates[k] = tigris.NativeFilter{
			Raw:      v,
			Compiled: c,
		}
	}
}
